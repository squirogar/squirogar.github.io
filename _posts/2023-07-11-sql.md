---
layout: post
title: SQL
date: 2023-07-09 19:56
description: Recordatorio de los comandos más usados en sql
categories: databases
giscus_comments: true
related_posts: true
---

## Qué es una base de datos
De [microsoft] (https://support.microsoft.com/es-es/office/conceptos-b%C3%A1sicos-sobre-bases-de-datos-a849ac16-07c7-4a31-9948-3c8c94a7c204#:~:text=Una%20base%20de%20datos%20es,programa%20de%20procesamiento%20de%20texto.): *Una base de datos es una herramienta para recopilar y organizar información. Las bases de datos pueden almacenar información sobre personas, productos, pedidos u otras cosas*

Lo importante de una base de datos es que:
1. tenga datos: queremos guardar datos para luego procesarla y organizarla. Estos datos son información cuando los datos guardados tienen sentido
2. los datos deben poder relacionarse. No tiene sentido guardar datos que no tienen ninguna relación.

## Cómo guardar, organizar y procesar datos en una base de datos
Hacemos uso de un software llamado **SGBD** (en inglés Relational Database Management System (RDMS)). Un SGBD es un sistema de gestión de base de datos. Ejemplos de estos softwares son: MySQL, PostgreSQL, MariaDB, Oracle, etc.

Algunas funciones que cumplen los SGBD:
- seguridad e integridad de los datos
- respaldos
- importación y exportación de los datos
- concurrencia. Este apartado de concurrencia es super importante porque el SGBD se tiene que preocupar de solucionar posbiles conflictos como dos usuarios intentan eliminar y leer un registro al mismo tiempo.

Las operaciones más comunes dentro de los softwares de gestión de base de datos son el CRUD:
1. CREATE
2. READ
3. UPDATE
4. DELETE

Para poder acceder a los registros y realizar estas 4 operaciones necesitamos escribir una **query** o consulta.

> Query <=> consulta

Existen dos tipos de SGBD:
1. SGBD que implementan SQL. Estas bases de datos se llaman base de datos relacionales y almacenan la información mediante tablas con filas y columnas.
2. SGBD que no implementan SQL. Estas bases de datos se llaman NO-SQL o base de datos no relacionales. Existen múltiples forman de guardar los datos:
	- formato JSON
	- formato BSON
	- formato BLOB
	- etc


## Base de datos relacionales
Se guardan los datos en una tabla. Una tabla se conforman de registros o filas y columnas o campos. Las columnas describen el dato.

|             USUARIO            |
|--------------------------------|
| Column 1 | Column 2 | Column 3 |
|----------|----------|----------|
| Row 1    | Cell 2   | Cell 3   |
| Row 2    | Cell 5   | Cell 6   |
| Row 3    | Cell 8   | Cell 9   |


```
USUARIO
id nombre edad
1	felipe	20
```
- El id es una columna que describe un identificador único del registro y que generalmente es automático y autoincrementable
- "1", "felipe" y "20" son datos por sí mismos.
- Si a esta tabla le asignamos el nombre de "user" ahí le damos contexto, ya que sabemos que esos datos hacen referencia a un usuario. Es ahí cuando tenemos información. Es muy importante que los datos se transformen en información, ya que así tienen sentido.

- Es importante el uso de id en vez de usar el nombre u otro dato de un usuario, ya que estos se pueden repetir o pueden cambiar.

- Es importante que en la base de datos no hay duplicación de registros.

- Todas las bases de datos relacionales o SQL crean tablas y las asocian mediante claves.

- relación 1<->n: se pone la clave primaria de (1) en la tabla de (n)
```
PRODUCTO
id nombre creado_por
1 	clavo	1

USUARIO
id nombre edad
1	felipe	20
```

- relación n<->n: se crea una tabla intermedia. En esta tabla van las claves primarias de las 2 tablas que se relacionan.
```
ALUMNOS
id nombre edad
1 	felipe	25
2 	carlos 	19

DEPORTE
id nombre
1	futbol
2 	tenis
3 	remo

ALUMNOS_DEPORTE
id alumno_id deporte_id
1 	1 			1
2 	1 			2
3 	2 			3
```

- la "primary key" es la columna que identifica a un registro como único.
- la "foregin key" es la columna que identifica a un registro de otra tabla que se relaciona con la tabla actual.


# tipos de datos
- int: integer
- float: decimal
- varchar(cantidad de caracteres máximo): string


# comandos

Siempre agregar el ; después de cada instrucción.

```
# crea la base de datos
create database nombrebd;

# ver todas las bases de datos que existen
show databases;

# indicamos la base de datos a utilizar
use nombrebd;

# creamos una tabla
CREATE TABLE nombretabla (
	id int AUTO_INCREMENT,
	columna1 varchar(255), 
	columna2 varchar(255) NOT NULL,
	columna3 int NOT NULL,
	PRIMARY KEY (id),
);

```

1. Insertar datos en una tabla
Primero, debemos indicar a qué columnas queremos insertarle datos. Luego, le indicamos los valores que irán en cada columna indicada.

```
# 1: un solo valor #
INSERT INTO nombretabla (columna1, columna2) VALUES ("valor col1", "valor col2");

# 2: varios valores #
INSERT INTO product (name, created_by, marca)
VALUES 
	("ipad", 1, "apple"),
	("iphone", 1, "apple"),
	("watch", 2, "apple"),
	("macbook", 1, "apple"),
	("imac", 3, "apple"),
	("ipad mini", 2, "apple");
```




* esto es para solucionar si es que nos da un error al no establecer el id como autoincrementable.
```
ALTER TABLE nombretabla MODIFY COLUMN id int auto_increment;
```





2. Listar registros de una tabla
```
# 1 #
SELECT columna1, columna2 FROM nombretabla WHERE id = 1;

# 2 #
SELECT * FROM nombretabla WHERE columna1 = "dato" AND columna2 = "dato2";

# 3 #
SELECT * FROM nombretabla WHERE columna1 >= 10 LIMIT 5; 

# 4 #
SELECT * FROM nombretabla WHERE columna1 > 20 OR columna2 = "dato2";

# 5 #
SELECT * FROM nombretable WHERE columna2 != "dato2";

# 6 #
SELECT * FROM nombretable WHERE columna1 BETWEEN 5 AND 10;

# 7: busca que contenga la palabra hola, da lo mismo el inicio y el final #
SELECT * FROM nombretable WHERE columna2 LIKE "%hola%;

# debe terminar con hola #
SELECT * FROM nombretable WHERE columna2 LIKE "%hola;

# debe empezar con hola #
SELECT * FROM nombretable WHERE columna2 LIKE "hola%;

# 8 #
SELECT * FROM nombretable ORDER BY columna2 ASC;

SELECT * FROM nombretable ORDER BY columna2 DESC;

# 9: el mayor de algo. AS es el alias#
SELECT MAX(columna1) AS mayor FROM nombretable;

# 10: el menor de algo #
SELECT MIN(columna1) AS menor FROM nombretable;

```


3. Actualizar datos de una tabla
Es muy importante proporcionar el "where", ya que si no fuera así, modificaría todos los registros en la tabla en el campo especificado.

```
UPDATE nombretabla SET columna1 = "xxxx" WHERE id = 3;
```

4. Eliminar los registros de una tabla
Es muy importante proporcionar el "where", ya que si no fuera así, borraría todos los registros en la tabla en el campo especificado.

```
DELETE FROM nombretabla WHERE columna1 = "dato";
```



# Clave foránea
Tenemos que indicar:
- qué columna de la tabla actual es la clave foránea
- a qué tabla hace referencia la clave foránea junto con el nombre de la columna de esa tabla a la que referenciamos.

create table products(
	id int not null auto_increment,
	name varchar(50) not null,
	created_by int not null,
	marca varchar(50) not null,
	primary key(id),
	foreign key(created_by) references user(id)
);

create table user(
	id int not null auto_increment,
	nombre varchar(50) not null,
	primary key(id),
);

* Esto es para renombrar una tabla:
```
rename table nombre_viejo to nombre_nuevo;
```


# JOIN: Unir tabla usuario con product

# 1. left join entre user y products: la tabla principal es la tabla user

los datos de la tabla de la izquierda (LEFT) se muestran sí o sí. Los de la tabla de la derecha se muestran solamente si se han podido emparejar; en caso contrario, se muestra NULL.

Cuando hacemos un left join, vamos a indicar que:
- debe traer todos los registros que encuentre en user (obviamente los que cumplan las condiciones especificadas en la consulta) y en el caso que se encuentren registros dentro de products que hayan sido creados por un usuario que aparecerá en en el resultado de la consulta, en ese caso, esos productos aparecerán en el resultado de la consulta. Si se crearon productos cuyos creadores no estén en el resultado de la consulta, entonces no se mostrarán.

******** imagen left join

```
# hay que especificar de qué tabla salen los campos
# on es para unir las tablas mediante una columna en común

SELECT u.id, u.nombre, p.name FROM user u LEFT JOIN product p on u.id = p.created_by;
``` 

# 2. right join entre user y products: la tabla principal es la tabla products

los datos de la tabla de la derecha (RIGHT) se muestran sí o sí. Los de la tabla de la izquierda se muestran solamente si se han podido emparejar; en caso contrario, se muestra NULL.

```
# hay que especificar de qué tabla salen los campos
# on es para unir las tablas mediante una columna en común

SELECT u.id, u.nombre, p.name FROM user u RIGHT JOIN product p on u.id = p.created_by;
``` 
- trae todos los registros de productos (que cumplen con la condición en la consulta) y en el caso que se encuentren usuarios que hayan creado dichos productos aparecerán en la consulta. Si hay usuarios que no crearon algún producto, no se mostrará en la consulta.

****** imagen right join

# 3. Inner Join entre users y products
Nos trae registros de usuarios y productos siempre y cuando estos dos puedan ser asociados. Básicamente es la intersección de las dos tablas.

```
# hay que especificar de qué tabla salen los campos
# on es para unir las tablas mediante una columna en común

SELECT u.id, u.nombre, p.name FROM user u INNER JOIN product p on u.id = p.created_by;
``` 

# group by

```
# 1 #
# retorna la cantidad de productos de cada marca
select count(id), marca from product group by marca;

# 2 #
# retorna la cantidad de productos creados por cada usuario
select count(p.id), u.nombre fromm product p left join user u on u.id = p.created_by group by p.created_by; 
```

# having
Hacer que las consultas de group by retorne los registros que cumplan una determinada condición. Por ejemplo, retornar la cantidad de productos creados por cada usuario siempre y cuando sea mayor a 2

```
select count(p.id), u.nombre from product p left join user u
on u.id = p.created_by group by p.created_by
having count(p.id) > 2; 
```

# eliminar tabla
```
drop table product;
```


# cardinalidad
son las relaciones entre tabla, por ejemplo, 1 a 1, 1 a n, n a n, etc.


